<app-header></app-header>

<!-- ================= FULL SCREEN LOADER ================= -->
<div *ngIf="isLoading" class="fullscreen-loader">
  <div class="loader-content text-center">
    <div class="spinner-border text-light mb-3"
         style="width: 3rem; height: 3rem;"
         role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
    <h5 class="text-light mb-1">Sending Message</h5>
    <p class="text-light-50 mb-0">Please wait…</p>
  </div>
</div>
<!-- ====================================================== -->

<section id="contact" class="contact-section">
  <div class="container py-5">

    <div class="row">

      <!-- ================= CONTACT FORM ================= -->
      <div class="col-lg-8 mb-5">

        <!-- SUCCESS -->
        <div *ngIf="success" class="alert alert-success alert-dismissible fade show mb-4">
          <i class="fa fa-check-circle me-2"></i>
          <strong>Thank you!</strong> Your message has been sent successfully.
          <button type="button" class="btn-close" (click)="success=false"></button>
        </div>

        <!-- ERROR -->
        <div *ngIf="error" class="alert alert-danger alert-dismissible fade show mb-4">
          <i class="fa fa-exclamation-circle me-2"></i>
          <strong>Error!</strong> Please try again.
          <button type="button" class="btn-close" (click)="error=false"></button>
        </div>

        <!-- FORM CARD -->
        <div class="contact-form-card p-4 rounded-3 shadow-sm">
          <h3 class="mb-4">Send Us a Message</h3>

          <form [formGroup]="contactForm"
                (ngSubmit)="onSubmit()"
                (change)="onFormChange()">

            <!-- NAME + EMAIL -->
            <div class="row mb-4">
              <div class="col-md-6 mb-3">
                <label class="form-label fw-semibold">Full Name *</label>
                <input type="text"
                       class="form-control form-control-lg"
                       placeholder="Enter your full name"
                       formControlName="name"
                       [class.is-invalid]="submitted && name?.invalid">
                <div class="invalid-feedback">Name is required</div>
              </div>

              <div class="col-md-6 mb-3">
                <label class="form-label fw-semibold">Email *</label>
                <input type="email"
                       class="form-control form-control-lg"
                       placeholder="your.email@example.com"
                       formControlName="email"
                       [class.is-invalid]="submitted && email?.invalid">
                <div class="invalid-feedback">Valid email is required</div>
              </div>
            </div>

            <!-- PHONE -->
            <div class="row mb-4">
              <div class="col-md-6 mb-3">
                <label class="form-label fw-semibold">Phone *</label>

                <div class="input-group has-validation">
                  <span class="input-group-text">+91</span>

                  <input type="tel"
                         class="form-control form-control-lg"
                         placeholder="9876543210"
                         formControlName="phone"
                         [class.is-invalid]="submitted && phone?.invalid">

                  <!-- ✅ ERROR MUST BE HERE -->
                  <div class="invalid-feedback">
                    Valid phone number required
                  </div>
                </div>

              </div>
            </div>


            <!-- SUBJECT -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Subject *</label>
              <input type="text"
                     class="form-control form-control-lg"
                     placeholder="Brief subject of your inquiry"
                     formControlName="subject"
                     [class.is-invalid]="submitted && subject?.invalid">
              <div class="invalid-feedback">Subject is required</div>
            </div>

            <!-- MESSAGE -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Message *</label>
              <textarea rows="6"
                        class="form-control form-control-lg"
                        placeholder="Please describe your requirements…"
                        formControlName="message"
                        [class.is-invalid]="submitted && message?.invalid"></textarea>
              <div class="invalid-feedback">Message must be at least 10 characters</div>
              <div class="form-text text-end">
                {{ message?.value?.length || 0 }} / 1000
              </div>
            </div>

            <!-- PREFERRED CONTACT -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Preferred Contact</label>
              <div class="btn-group w-100">
                <button type="button"
                        class="btn btn-outline-primary"
                        [class.active]="contactForm.value.preferredContact === 'phone'"
                        (click)="contactForm.patchValue({ preferredContact:'phone' })">
                  Phone
                </button>
                <button type="button"
                        class="btn btn-outline-primary"
                        [class.active]="contactForm.value.preferredContact === 'email'"
                        (click)="contactForm.patchValue({ preferredContact:'email' })">
                  Email
                </button>
                <button type="button"
                        class="btn btn-outline-primary"
                        [class.active]="contactForm.value.preferredContact === 'whatsapp'"
                        (click)="contactForm.patchValue({ preferredContact:'whatsapp' })">
                  WhatsApp
                </button>
              </div>
            </div>

            <!-- ACTIONS -->
            <div class="d-flex gap-3">
              <button type="submit"
                      class="btn btn-primary btn-lg px-5"
                      [disabled]="isLoading">
                <i class="fa fa-paper-plane me-2"></i>
                Send Message
              </button>
            </div>

          </form>
        </div>
      </div>

      <!-- ================= RIGHT COLUMN ================= -->
      <div class="col-lg-4">

        <!-- OFFICES -->
        <div class="offices-card mb-4 p-4 rounded-3 shadow-sm">
          <h5 class="mb-4">
            <i class="fa fa-map-marker-alt me-2 text-primary"></i> Our Office
          </h5>

          <div *ngFor="let office of offices"
               class="office-item mb-3 p-3 border rounded"
               [class.active-office]="office.city === selectedOffice.city"
               (click)="selectOffice(office)">
            <h6>{{ office.city }}</h6>
            <p class="small text-muted">{{ office.address }}</p>
          </div>
        </div>
        <div class="map-placeholder mt-4 p-3 border rounded text-center">
          <i class="fa fa-map fa-3x text-muted mb-3"></i>
          <h6>Office Location Map</h6>
          <p class="small text-muted mb-3">View our {{selectedOffice.city}} office location</p>
          <a [href]="selectedOffice.mapLink"
             target="_blank"
             class="btn btn-outline-primary btn-sm">
            <i class="fa fa-directions me-1"></i> Get Directions
          </a>
        </div>
        <!-- QUICK CONTACT -->
        <div class="quick-contact-card p-4 rounded-3 shadow-sm">
          <h5 class="mb-4">
            <i class="fa fa-bolt me-2 text-primary"></i> Quick Contact
          </h5>

          <div class="mb-3 d-flex align-items-center">
            <i class="fa fa-phone-alt me-3 text-primary"></i>
            +91 9876543210
          </div>

          <div class="mb-3 d-flex align-items-center">
            <i class="fab fa-whatsapp me-3 text-success"></i>
            WhatsApp
            <button class="btn btn-sm ms-auto" (click)="openWhatsApp()">Chat</button>
          </div>

          <div class="d-flex align-items-center">
            <i class="fa fa-envelope me-3 text-danger"></i>
            info@rsnandco.com
            <button class="btn btn-sm ms-auto"
                    (click)="copyEmail('info@rsnandco.com')">
              Copy
            </button>
          </div>
        </div>

      </div>

    </div>
  </div>
</section>
